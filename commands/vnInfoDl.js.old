/* eslint-disable indent */
const { SlashCommandBuilder } = require('discord.js');
const VndbService = require('../services/vndb_service');

module.exports = {
	data: new SlashCommandBuilder()
    .setName('vn')
    .setDescription('Visual Novel Search Engine')
    .addSubcommand(subcommand =>
        subcommand
            .setName('search')
            .setDescription('Find Visual Novel By Title')
            .addStringOption(option =>
                option.setName('title')
                    .setDescription('Please enter the title keyword you want to search')
                    .setRequired(true),
        ),
    ),
	async execute(interaction, client) {
        try {
            // Initialized Service
            const vndbService = new VndbService(client);

            if (interaction.options.getSubcommand() === 'info') {
                await interaction.deferReply();
                const res = await vndbService.getInfo(interaction.options.getInteger('id'));
                if (res == null) {
                    await interaction.editReply({ embeds: [this.errorEmbed('Not Found', 'Sorry, we didn\'t find the vn you are looking for, please check the vn id again.', client)] });
                }
                await interaction.editReply({ embeds: [res], ephemeral: false });
            }
        }
        catch (err) {
            console.error(err);
        }
	},
    errorEmbed(title, message, client) {
        return {
            color: 0xe01212,
            title: title, message,
            author: {
                name: 'ATRI Visual Novel Search Engine',
                icon_url: client.user.avatarURL(),
            },
            description: message,
            timestamp: new Date(),
            footer: {
                text: `ATRI Version: ${process.env.VERSION}`,
            },
        };
    },
};